Thu Mar 17 23:23:42 UTC 2005 Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* eval.c (set_BINMODE, set_XMLMODE): Fix spelling of "arbitrary".

Thu Mar 17 23:21:17 UTC 2005 Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* awkgram.y (isnoeffect): Add Node_XMLMODE to list.
	(isassignable): Add Node_XMLMODE to list.

Wed Mar 16 22:08:45 UTC 2005 Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* xml_puller.c (XML_PullerIconv): Calculate the maximum length of the
	converted string using MB_LEN_MAX (defined in <limits.h>) instead
	of the constant "4".

Wed Mar 16 19:21:25 UTC 2005 Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* main.c (init_vars): Install XMLATTR array variable.
	(main): Initialization of XMLATTR belongs in init_vars, not in main.

Wed Mar 16 18:02:08 UTC 2005 Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* main.c (main): Install XMLATTR variable before processing the
	command-line preassignments (using -v).  Previously, any value provided
	for XMLATTR on the command-line was being silently ignored.  Now, it
	will give an error.

Tue Mar 15 21:24:25 UTC 2005 Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* awk.h: Declare new global variable NODE *XMLNAME_node.
	* main.c (varinit): Add entry for XMLNAME_node.
	* io.c (resetXMLvars): Must reset new variable XMLNAME.
	(set_xml_attr): New function to insert an entry into the XMLATTR array.
	(get_xml_record): Add SET_NAME macro to use dupnode to set XMLNAME.
	Insert calls to SET_NAME and set_xml_attr to reflect event information
	appropriately.

Tue Mar 15 18:43:34 UTC 2005 Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* awk.h: Change struct iobuf xml.space from char[4] to char *.
	Add xml.string_cache[] array to save XMLEVENT string values.
	* io.c (xml_event_init): Remove function and all xml_event_* global
	variables, since the strings must be cached on a per-puller basis
	to make sure they have the correct encoding.
	(iop_close): Must free iop->xml.space and iop->xml.string_cache[*].
	(convert_xmlcharset_space): Remove obsolete function (use new
	XML_PullerIconv function instead).
	(iop_alloc): Call XML_PullerIconv to calculate iop->xml.space.
	Do not call xml_event_init, this is now handled differently.
	(get_xml_string): New function to generate encoded XMLEVENT strings.
	(get_xml_record): Change SET_EVENT macro to check the appropriate slot
	in iop->xml.string_cache[].

Tue Mar 15 17:32:48 UTC 2005 Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* xml_puller.h (XML_PullerIconv): Declare new function used to convert
	string encoding.
	* xml_puller.c (XML_PullerIconv): Rename XML_PullerAllocateAndCheck to
	XML_PullerIconv and make it public so that it can be called from gawk.

Mon Mar 14 22:04:27 UTC 2005 Juergen Kahrs <jkahrs@users.sourceforge.net>

	* doc/XMLChangeLog: Added a separate ChangeLog for the doc of
	the XML extension.
	* test/XMLChangeLog: Added a separate ChangeLog for the
	regression tests of the XML extension.

Mon Mar 14 17:20:21 UTC 2005 Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* awk.h (update_ERRNO_saved): Declare new function that allows the
	caller to specify the errno value used for the error string.
	* eval.c (update_ERRNO_saved): New function to use saved errno value
	instead of the current value.
	(update_ERRNO): Implement by calling update_ERRNO_saved.
	* io.c (close_redir): Save errno value and call update_ERRNO_saved
	instead of update_ERRNO.
	(do_getline): Call update_ERRNO_saved instead of update_ERRNO.
	But do not call update_ERRNO if get_a_record returns with errcode
	set to -1.
	(get_xml_record): If the XML parser indicated an error, and the
	errcode pointer is non-NULL, set errcode to -1 so that getline
	will return -1.

Mon Mar 14 16:25:31 UTC 2005 Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* io.c (get_xml_record): Set ERRNO to have same value as XMLERROR.

Sun Mar 13 21:19:14 UTC 2005 Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* xml_puller.h: Add new error_len field XML_Puller structure (since
	error string is now encoded and counted).
	* xml_puller.c: Improve internal_error() messages throughout.
	(XML_PullerSetError): Add a standard prefix for expat errors ["Expat
	XML Parser error:"].  Check that expat error string is non-NULL.
	Call XML_PullerAllocateAndCheck to convert the error message to the
	proper encoding.
	(internal_error): Call XML_PullerAllocateAndCheck to convert the error
	message to the proper encoding.
	(XML_PullerFree): Must free puller->error (now that it is allocated).
	* io.c (get_xml_record): Make sure puller error string is not NULL.
	The error string is now encoded and counted and malloced, so just
	steal it (instead of copying).

Sun Mar 13 19:43:40 UTC 2005 Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* awk.h: Remove NODETYPE Node_XMLCHARSET.  And remove declaration
	of set_XMLCHARSET.
	* eval.c (nodetypes): Remove Node_XMLCHARSET.
	(r_tree_eval, r_get_lhs) Remove case for Node_XMLCHARSET.
	(set_XMLCHARSET) Remove empty (unused) function.
	* main.c (varinit): Change type of XMLCHARSET_node from Node_XMLCHARSET
	to Node_var.
	* profile.c (tree_eval, pp_lhs, is_scalar, prec_level) Remove case
	for Node_XMLCHARSET.

Sun Mar 13 14:47:57 UTC 2005 Juergen Kahrs <jkahrs@users.sourceforge.net>
	* doc/xmlgawk.texi: Inserted menu items for each chapter
	to stop makeinfo from whining.

Sat Mar 12 23:05:35 UTC 2005  Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* awkgram.y (variable): Remove special check for XMLATTR since
	it is created immediately at program startup (not on a delayed
	basis like PROCINFO and ENVIRON).

Sa Mar 12 21:47:01 UTC 2005 Juergen Kahrs <jkahrs@users.sourceforge.net>
	* doc/.cvsignore Now all .info, .html, .ps and .dvi files are
	ignored (not only those generated from xmlgawk).

Sa Mar 12 21:38:02 UTC 2005 Juergen Kahrs <jkahrs@users.sourceforge.net>
	* doc/Makefile.am, doc/Makefile.in
	* With these files checked in, it is now possible to produce
        xmlgawk.ps and xmlgawk.html. The whole process is not quite
	clean yet. make html fails at first sight, but the file is
	created and usable. After a fresh cvs co of xmlgawk, the first
	make in the top directory will fail for some reason in the doc
	directory. Furthermore, gawk.texi has some problems. But all
	this sounds worse than it is because everything is produced
	correctly anyay.

Sat Mar 12 20:58:52 UTC 2005  Juergen Kahrs <jkahrs@users.sourceforge.net>
	* doc/fdl.texi The file doc/fdl.texi is included by doc/xmlgawk.texi.
	* doc/awk_proc.eps doc/docbook_chapter.eps doc/rss_inq.eps
	doc/soap_error.eps doc/soap_reply.eps doc/soap_request.eps
	are new files used by doc/xmlgawk.texi.
	* doc/xmlgawk.texi The .eps files have been checked in under
	slightly different names.

Sat Mar 12 20:36:54 UTC 2005  Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* xml_puller.c (XML_PullerNext): If read returns -1, we should set
	puller status to XML_STATUS_ERROR to indicate that there was an I/O
	error.

Sat Mar 12 20:23:26 UTC 2005  Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* awk.h: Declare XMLEVENT_node.
	* main.c: New global variable XMLEVENT_node.
	(varinit) Added entry for XMLEVENT.
	* io.c: Add static xml_event_* variables to cache XMLEVENT values.
	(resetXMLvars): Must reset new XMLEVENT variable.
	(iop_alloc): If opening an XML file, check whether xml_event_* variables
	have been initialized yet; if not, call xml_event_init.
	(xml_event_init): New function to initialize xml_event_* variables.
	(get_xml_record): For each kind of token returned by XML_PullerNext,
	set an appropriate value for XMLEVENT.

Sat Mar 12 18:37:14 UTC 2005  Andrew J. Schorr <ajschorr@users.sourceforge.net>

	* .cvsignore: Ignore changes in awkgram.c.
	* doc/.cvsignore: Ignore various files produced from the texinfo
	  source documentation.

Wed Mar  9 20:07:35 UTC 2005  Juergen Kahrs <jkahrs@users.sourceforge.net>
	* doc/xmlgawk.texi: Initial checkin. PostScript file
          and Makefile changes will follow later.

Wed Mar  9 20:24:04 UTC 2005  Juergen Kahrs <jkahrs@users.sourceforge.net>
	This source tree is based on the original distribution
        ftp://ftp.gnu.org/gnu/gawk/gawk-3.1.4.tar.gz.
	Then my patch patch_3.1.4__xml_20050305 was applied.
        Then Andrew's patch dated 2005-03-07 was applied.
        * awklib/xmllib.awk: Moved this from root to here before CVS import.
        * awklib/xmltree.awk: Moved this from root to here before CVS import.

Wed Mar  9 20:12:32 UTC 2005  Juergen Kahrs <jkahrs@users.sourceforge.net> 

        * ChangeLog created.
