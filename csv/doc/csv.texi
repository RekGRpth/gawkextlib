@node csvformat
@section CSV data generation
Adds facilities for creating comma-separed-values (CVS) data.
@unnumberedsubsec USAGE

@example
@strong{@@include "csv"}
...
@emph{result} = @strong{csvcompose}(@emph{afield}, @emph{option}...)
@emph{result} = @strong{csvformat}(@emph{record}, @emph{option}...)
@emph{result} = @strong{csvquote}(@emph{field}, @emph{option}...)
@strong{csvprint}(@emph{record}, @emph{option}...)
@strong{csvprint0}()
@end example

@unnumberedsubsec DESCRIPTION
The @code{csv.awk} library provides control variables and functions for composing CSV data records and fields:

@table @asis
@item @strong{CSVFS}
@cindex CSVFS
The expected field separator in the clean text record to be formatted. Default the null character '\0'.
@item @strong{CSVCOMMA}
@cindex CSVCOMMA
The resulting CSV field delimiter. Default comma ','.
@item @strong{CSVQUOTE}
@cindex CSVQUOTE
The resulting CSV quoting character. Default double quote '"'.
@item @strong{csvcompose(@emph{afield} [, @emph{comma} [, @emph{quote}]])}
@cindex csvcompose
Returns a CSV formatted string by composing the values in the @emph{afield} array. The arguments are as follows:

@table @asis
@item @strong{afield}
An array of field values, indexed from 1 to @emph{N}.
@item @strong{comma}
Optional. The resulting CSV field delimiter. Default @code{CSVCOMMA}.
@item @strong{quote}
Optional. The resulting CSV quoting character. Default @code{CSVQUOTE}.
@end table

@item @strong{csvformat(@emph{record}, [@emph{fs} [, @emph{comma} [, @emph{quote}]]])}
@cindex csvformat
Returns a CSV formatted string by composing the fields in the @emph{record} string. The arguments are as follows:

@table @asis
@item @strong{record}
A string record with fields delimited by @emph{fs}.
@item @strong{fs}
Optional. The actual field separator in @emph{record}. Default @code{CSVFS}.
@item @strong{comma}
Optional. The desired CSV field delimiter. Default @code{CSVCOMMA}.
@item @strong{quote}
Optional. The desired CSV quoting character. Default @code{CSVQUOTE}.
@end table

@item @strong{csvquote(@emph{field} [, @emph{comma} [, @emph{quote}]])}
@cindex csvquote
Returns a CSV formatted string by escaping the required characters in the @emph{field} string. The arguments are as follows:

@table @asis
@item @strong{field}
A single field clean text string.
@item @strong{comma}
Optional. The desired CSV field delimiter. Default @code{CSVCOMMA}.
@item @strong{quote}
Optional. The desired CSV quoting character. Default @code{CSVQUOTE}.
@end table

@item @strong{csvprint([@emph{record}, [@emph{fs} [, @emph{comma} [, @emph{quote}]]]])}
@cindex csvprint
A convenience function to format and print the given record with a single call. If called without arguments it prints either $0 formatted as CSV or @code{CSVRECORD}, depending on @code{CSVMODE}. Arguments are like @code{csvformat()}.
@item @strong{csvprint0()}
@cindex csvprint0
A convenience function to print the original input record as such. Prints either $0 or @code{CSVRECORD}, depending on @code{CSVMODE}.
@end table

@unnumberedsubsec EXAMPLES
Explicit CSV composition:

@example
f[1] = "007"
f[2] = "Bond, James"
f[3] = "United Kingdom"
result = csvcompose(f)  # -> '007,"Bond, James",United Kingdom'
result = csvcompose(f, ";")  # -> '007;Bond, James;United Kingdom'

record = "007/Bond, James/United Kingdom"
result = csvformat(record, "/")  # -> '007,"Bond, James",United Kingdom'
result = csvformat(record, "/", ";")  # -> '007;Bond, James;United Kingdom'
@end example

Print records that contain commas as data, in both normal and CSV modes:

@example
grepcommas.awk:
BEGINFILE @{
    CSVMODE = (FILENAME ~ /\.csv$/)
@}
/,/ @{ csvprint0() @}

Sample invocation:
gawk -f grepcommas.awk a.txt, b.csv, c.txt
@end example

@unnumberedsubsec NOTES
The @emph{csv} library automatically loads the CSV extension.
@unnumberedsubsec LIMITATIONS
